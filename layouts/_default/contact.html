{{ define "main" }}
<div class="max-w-4xl mx-auto px-4 py-12">
  <h1
    class="text-5xl font-bold mb-6 text-text-primary-light dark:text-text-primary-dark"
  >
    {{ .Title }}
  </h1>
  <div
    class="bg-bg-primary-light dark:bg-bg-secondary-dark p-8 rounded-lg border border-border-primary-light dark:border-border-primary-dark"
  >
    <div class="prose prose-invert prose-lg max-w-none">
      <div
        class="text-text-secondary-light dark:text-text-secondary-dark text-lg mb-8"
      >
        {{ .Content }}

        <!-- Contact Form -->
        <form
          method="POST"
          action="https://formcarry.com/s/J-8C6QgQr35"
          novalidate
          class="border border-border-primary-light dark:border-border-primary-dark rounded-lg p-6 bg-bg-primary-light dark:bg-bg-secondary-dark text-text-primary-light dark:text-text-primary-dark max-w-4xl mx-auto space-y-4"
        >
          <!-- Hidden fields -->
          <input
            type="hidden"
            name="_redirect"
            value="https://jorgefelipe.info/success/"
          />
          <input
            type="hidden"
            name="_subject"
            value="New message from your portfolio!"
          />
          <input type="text" name="_gotcha" style="display: none" />

          <div>
            <label
              for="name"
              class="block text-sm font-medium text-text-secondary-light dark:text-text-secondary-dark"
              >Name</label
            >
            <input
              type="text"
              id="name"
              name="name"
              required
              class="mt-1 block w-full rounded border border-border-primary-light dark:border-border-primary-dark bg-white dark:bg-bg-tertiary-dark text-text-primary-light dark:text-text-primary-dark p-2"
            />
          </div>

          <div>
            <label
              for="email"
              class="block text-sm font-medium text-text-secondary-light dark:text-text-secondary-dark"
              >Email</label
            >
            <input
              type="email"
              id="email"
              name="email"
              required
              class="mt-1 block w-full rounded border border-border-primary-light dark:border-border-primary-dark bg-white dark:bg-bg-tertiary-dark text-text-primary-light dark:text-text-primary-dark p-2"
            />
          </div>

          <div>
            <label
              for="message"
              class="block text-sm font-medium text-text-secondary-light dark:text-text-secondary-dark"
              >Message</label
            >
            <textarea
              id="message"
              name="message"
              rows="5"
              required
              class="mt-1 block w-full rounded border border-border-primary-light dark:border-border-primary-dark bg-white dark:bg-bg-tertiary-dark text-text-primary-light dark:text-text-primary-dark p-2"
            ></textarea>
          </div>

          <div>
            <button
              type="submit"
              class="bg-primary-light dark:bg-primary-dark text-primary-light dark:text-primary-dark border border-primary-light dark:border-primary-dark px-6 py-2 rounded-md font-medium shadow-sm hover:bg-secondary-dark dark:hover:bg-secondary-dark/80 hover:border-primary-dark dark:hover:border-primary-light transition-colors duration-300"
            >
              Send Message
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  // Toast helper
  function showToaster(message) {
    const toaster = document.createElement("div");
    toaster.className = "toaster";
    toaster.textContent = message;
    document.body.appendChild(toaster);
    setTimeout(() => toaster.classList.add("show"), 10);
    setTimeout(() => {
      toaster.classList.remove("show");
      setTimeout(() => document.body.removeChild(toaster), 500);
    }, 3000);
  }

  // Async form submission
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector('form[action*="formcarry.com"]');
    if (!form) return;

    form.addEventListener("submit", async function (e) {
      e.preventDefault();
      const data = new FormData(form);

      try {
        const response = await fetch(form.action, {
          method: form.method,
          body: data,
          headers: { Accept: "application/json" },
        });

        if (response.ok) {
          showToaster("Message sent successfully! ✅");
          form.reset();
        } else {
          showToaster("Oops! Something went wrong. ❌");
        }
      } catch (error) {
        console.error(error);
        showToaster("Network error. Please try again later.");
      }
    });
  });
</script>
{{ end }}
